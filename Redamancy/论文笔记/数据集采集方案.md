### 构建3D人体姿态估计数据集

#### 1. 3D人体姿态估计常见关键点数量选择

在3D人体姿态估计中，关键点的选择直接影响模型的表达能力和应用场景的覆盖范围。常见的标准关键点数量为17个，这一选择源于COCO数据集 ([COCO Dataset](https://cocodataset.org/#keypoints-2017)) 和Human3.6M数据集 ([Human3.6M Dataset](http://vision.imar.ro/human3.6m/desc.php)) 的广泛应用。17个关键点通常包括：
- **头部**: 鼻子、左眼、右眼、左耳、右耳；
- **上肢**: 左肩、右肩、左肘、右肘、左手腕、右手腕；
- **下肢**: 左髋、右髋、左膝、右膝、左踝、右踝。
![[Pasted image 20250325170917.png]]
![[Pasted image 20250325172958.png]]
**选择17个关键点的原因**：
- **全面性与简洁性的平衡**: 17个关键点覆盖了人体主要关节和特征点，能够较好地表示整体姿态，同时避免过于复杂的标注负担。
- **数据集一致性**: COCO和Human3.6M等公开数据集采用这一标准，便于模型训练和基准测试。
- **应用需求**: 在动作识别、动画生成和运动分析中，17个关键点足以捕捉主要运动轨迹。例如，文献[Deep 3D Human Pose Estimation: A Review](https://www.sciencedirect.com/science/article/pii/S1077314221000692)指出，这一数量在计算效率和精度间达到较优平衡。
Wang J, Tan S, Zhen X, et al. Deep 3D human pose estimation: A review[J]. Computer Vision and Image Understanding, 2021, 210: 103225.
#### 2. 关键点采集方法对比及应用分析

##### 采集方法对比表格

| 方法             | 适用场景         | 优点                     | 缺点                     | 典型数据集                |
|------------------|------------------|--------------------------|--------------------------|---------------------------|
| 运动捕捉系统     | 控制环境         | 高精度3D数据             | 需要专用设备，成本高     | Human3.6M, CMU Panoptic  |
| 手动标注         | 视频数据         | 灵活，适用于任何场景     | 耗时，依赖人工准确性     | MPII, COCO               |
| 自动化工具+精炼 | 视频数据         | 效率高，减少人工劳动     | 初始标注可能有误差       | LSP, DensePose           |

##### 方法详解及优缺点
1. **运动捕捉系统**
   - **优点**: 提供亚毫米级的3D精度，直接输出关键点的空间坐标，适合高精度需求场景。
   - **缺点**: 需要昂贵的设备（如红外相机、IMU传感器）和受控环境，野外场景难以部署。
   - **使用流程**: 
     1. 在人体关键部位佩戴标记点或IMU传感器。
     2. 使用多相机或传感器系统同步记录动作。
     3. 通过专用软件（如Vicon Nexus或Xsens MVN Analyze）处理数据，生成3D坐标。
   - **典型公司**: 
     - **Xsens**: MVN套装使用17个IMU传感器，实时生成3D姿态，常见于动画制作。
     - **Vicon**: 光学捕捉系统结合IMU，精度高，应用于生物力学研究。
     - **Rokoko**: Smartsuit提供低成本IMU方案，适合独立开发者。
   - **数据集**: Human3.6M使用多相机和IMU生成地面真实数据，CMU Panoptic采用光学捕捉。
### Vicon捕捉
![[Pasted image 20250325171947.png]]
[Vicon动作捕捉软件配置与实践完全入门指南 - 知乎](https://zhuanlan.zhihu.com/p/714132439)

2. **手动标注**
   - **优点**: 灵活性强，适用于任何视频数据，无需额外硬件。
   - **缺点**: 标注每帧2D关键点耗时长，且标注者主观性可能引入误差。
   - **使用流程**: 
     1. 从视频中提取帧。
     2. 使用工具（如LabelImg或自定义界面）逐帧标注2D关键点。
     3. 通过多视角数据或深度估计转换为3D坐标。
   - **数据集**: MPII Human Pose和COCO依赖人工标注2D关键点，后续研究常通过算法推导3D位置。

3. **自动化工具+精炼**
   - **优点**: 利用现有模型快速生成初始标注，大幅减少人工工作量。
   - **缺点**: 自动标注可能在遮挡或复杂姿态下出错，需人工校正。
   - **使用流程**: 
     1. 使用预训练模型（如OpenPose）处理视频，生成初步2D关键点。
     2. 人工检查并修正错误标注。
     3. 结合深度信息或多视角数据推算3D坐标。
   - **典型模型**: 
     - **OpenPose**: 开源2D姿态估计工具，输出17个关键点坐标。
     - **AlphaPose**: 高精度2D估计，适用于多人场景。
     - **HRNet**: 在复杂姿态下表现优异。
   - **数据集**: LSP和DensePose使用自动化工具生成初始标注，后经人工精炼。

#### 3. 常见的3D人体姿态估计坐标系设置方法

在3D人体姿态估计中，坐标系的定义影响数据表示和计算方式，常见方法包括：
- **相机坐标系**: 
  - 原点设在相机位置，x轴水平，y轴垂直，z轴指向前方。
  - **优点**: 便于多视角融合和三角测量，与视频数据采集一致。
  - **应用**: Human3.6M和大部分视频数据集采用此设置。
- **人体中心坐标系**: 
  - 原点设在人体中心（如骨盆或髋部中点），坐标轴基于人体方向。
  - **优点**: 姿态表示与人体解剖学相关，便于动作分析。
  - **应用**: 运动捕捉数据集（如CMU Mocap）常用。
- **世界坐标系**: 
  - 原点固定在环境中的某个点，独立于相机或人体。
  - **优点**: 适合多主体或动态场景跟踪。
  - **应用**: 野外数据集或机器人导航场景。

**推荐**: 对于视频数据，相机坐标系是标准选择，因其与采集设备直接相关，便于后续处理。

#### 4. 单视角与多视角的优劣及关键点采集中的必要性

- **单视角**:
  - **好处**: 设备简单，部署成本低，适合初步研究或资源有限场景。
  - **局限**: 深度信息模糊，遮挡问题严重，3D重建需依赖深度估计模型。
- **多视角**:
  - **好处**: 通过不同角度消除遮挡，提供冗余数据，显著提高3D重建精度。
  - **局限**: 需要同步多相机，校准复杂，成本较高。

**关键点采集中的必要性**:
- **运动捕捉系统**: 多视角非必须，因IMU或光学标记可直接提供3D数据，但多相机可增强精度（如Vicon系统）。
- **手动标注**: 多视角必要，通过不同视图的2D标注计算3D位置（如Human3.6M）。
- **自动化工具+精炼**: 多视角可选，单视角可通过深度模型推算3D，但多视角能提升鲁棒性。

**结论**: 若目标是高精度数据集，多视角在基于视频的采集方法中尤为重要。

#### 5. 具体流程方案及三角测量方法详解

##### 完整流程
1. **定义关键点与坐标系**: 选择17个关键点，坐标原点设在相机位置。
2. **相机设置**: 使用4个同步相机，覆盖前、侧、后视角，完成校准。
3. **视频捕获**: 记录10分钟动作视频（30fps，1080p）。
4. **2D关键点标注**: 使用OpenPose生成初始标注，人工精炼每帧的17个关键点。
5. **3D坐标计算**: 通过三角测量从多视角2D数据推算3D位置。
6. **数据存储**: 保存3D坐标、视频帧和相机参数，验证完整性。

##### 三角测量方法原理与用法
- **原理**: 三角测量利用多视角的2D关键点坐标和相机参数，计算其在3D空间的交点。
  - 假设有两台相机C1和C2，已知其内在参数（焦距f、畸变）和外在参数（位置T、旋转R）。
  - 对于某关键点P，其在C1的图像坐标为(x1, y1)，在C2为(x2, y2)。
  - 根据相机投影模型，反投影生成两条射线，P为这两条射线的交点（理想情况）或最近点（考虑误差）。
- **数学公式**:
  - 相机投影：$\( x = f \cdot \frac{X}{Z} \)，\( y = f \cdot \frac{Y}{Z} \)$。
  - 给定两视角的投影方程，求解P(X, Y, Z)：
    $A \cdot P = b$
    其中A由相机参数构造，b为2D坐标观测值，使用最小二乘法求解。
- **用法**:
  1. 输入：每个视角的2D关键点坐标和相机内外参数。
  2. 反投影：将2D点转换为3D射线。
  3. 优化：计算射线交点或最小化重投影误差。
  4. 输出：关键点的3D坐标。
- **工具**: OpenCV的`triangulatePoints`函数，或MATLAB的三角测量工具包。

**示例**: 对于“左肩”点，若相机1标注为(300, 200)，相机2为(250, 210)，结合相机参数计算其3D位置(X, Y, Z)，重复此过程生成所有关键点的3D数据。